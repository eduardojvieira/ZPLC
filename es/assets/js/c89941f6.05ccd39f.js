"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[7937],{9285(e,n,i){i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>a,frontMatter:()=>d,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"ide/compiler","title":"ST Compiler","description":"The ZPLC Structured Text compiler transforms IEC 61131-3 ST source code into optimized bytecode for the ZPLC Virtual Machine. The compiler is written in TypeScript and runs entirely in the browser.","source":"@site/docs/ide/compiler.md","sourceDirName":"ide","slug":"/ide/compiler","permalink":"/ZPLC/es/docs/ide/compiler","draft":false,"unlisted":false,"editUrl":"https://github.com/eduardojvieira/ZPLC/tree/master/docs/docs/ide/compiler.md","tags":[],"version":"current","frontMatter":{},"sidebar":"ideSidebar","next":{"title":"Deployment","permalink":"/ZPLC/es/docs/ide/deployment"}}');var r=i(4848),l=i(8453);const d={},t="ST Compiler",c={},o=[{value:"Compilation Pipeline",id:"compilation-pipeline",level:2},{value:"1. Lexical Analysis (Lexer)",id:"1-lexical-analysis-lexer",level:3},{value:"2. Parsing",id:"2-parsing",level:3},{value:"3. Semantic Analysis",id:"3-semantic-analysis",level:3},{value:"4. IR Generation",id:"4-ir-generation",level:3},{value:"5. Optimization",id:"5-optimization",level:3},{value:"6. Code Generation",id:"6-code-generation",level:3},{value:"Language Support",id:"language-support",level:2},{value:"Data Types",id:"data-types",level:3},{value:"Operators",id:"operators",level:3},{value:"Control Structures",id:"control-structures",level:3},{value:"Function Blocks",id:"function-blocks",level:2},{value:"Using Standard FBs",id:"using-standard-fbs",level:3},{value:"Defining Custom FBs",id:"defining-custom-fbs",level:3},{value:"Compiler Messages",id:"compiler-messages",level:2},{value:"Error Format",id:"error-format",level:3},{value:"Common Errors",id:"common-errors",level:3},{value:"Warnings",id:"warnings",level:3},{value:"Compiler Options",id:"compiler-options",level:2},{value:"Output: The .zplc File",id:"output-the-zplc-file",level:2}];function h(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"st-compiler",children:"ST Compiler"})}),"\n",(0,r.jsx)(n.p,{children:"The ZPLC Structured Text compiler transforms IEC 61131-3 ST source code into optimized bytecode for the ZPLC Virtual Machine. The compiler is written in TypeScript and runs entirely in the browser."}),"\n",(0,r.jsx)(n.h2,{id:"compilation-pipeline",children:"Compilation Pipeline"}),"\n",(0,r.jsx)(n.mermaid,{value:"graph LR\n    A[ST Source] --\x3e B[Lexer]\n    B --\x3e C[Parser]\n    C --\x3e D[AST]\n    D --\x3e E[Semantic Analysis]\n    E --\x3e F[IR Generation]\n    F --\x3e G[Optimization]\n    G --\x3e H[Code Generation]\n    H --\x3e I[.zplc Binary]"}),"\n",(0,r.jsx)(n.h3,{id:"1-lexical-analysis-lexer",children:"1. Lexical Analysis (Lexer)"}),"\n",(0,r.jsx)(n.p,{children:"The lexer tokenizes the ST source code into a stream of tokens:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Input:  IF counter > 10 THEN motor := TRUE; END_IF;\n\nTokens: [IF] [IDENT:counter] [GT] [INT:10] [THEN] \n        [IDENT:motor] [ASSIGN] [TRUE] [SEMI] [END_IF] [SEMI]\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-parsing",children:"2. Parsing"}),"\n",(0,r.jsx)(n.p,{children:"The parser builds an Abstract Syntax Tree (AST) from the token stream using a recursive descent parser."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Supported Constructs:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Variable declarations (",(0,r.jsx)(n.code,{children:"VAR"}),", ",(0,r.jsx)(n.code,{children:"VAR_INPUT"}),", ",(0,r.jsx)(n.code,{children:"VAR_OUTPUT"}),", ",(0,r.jsx)(n.code,{children:"VAR_RETAIN"}),")"]}),"\n",(0,r.jsx)(n.li,{children:"Assignments"}),"\n",(0,r.jsx)(n.li,{children:"IF/THEN/ELSIF/ELSE/END_IF"}),"\n",(0,r.jsx)(n.li,{children:"CASE/OF/END_CASE"}),"\n",(0,r.jsx)(n.li,{children:"FOR/TO/BY/DO/END_FOR"}),"\n",(0,r.jsx)(n.li,{children:"WHILE/DO/END_WHILE"}),"\n",(0,r.jsx)(n.li,{children:"REPEAT/UNTIL/END_REPEAT"}),"\n",(0,r.jsx)(n.li,{children:"Function calls"}),"\n",(0,r.jsx)(n.li,{children:"Function block instantiation"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"3-semantic-analysis",children:"3. Semantic Analysis"}),"\n",(0,r.jsx)(n.p,{children:"Type checking and scope resolution:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Verify all variables are declared"}),"\n",(0,r.jsx)(n.li,{children:"Check type compatibility in assignments and expressions"}),"\n",(0,r.jsx)(n.li,{children:"Resolve function block instance methods"}),"\n",(0,r.jsx)(n.li,{children:"Validate array bounds (when possible)"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"4-ir-generation",children:"4. IR Generation"}),"\n",(0,r.jsx)(n.p,{children:"The AST is lowered to an intermediate representation closer to the bytecode:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"ST:  result := a + b * c;\n\nIR:  LOAD a\n     LOAD b\n     LOAD c\n     MUL\n     ADD\n     STORE result\n"})}),"\n",(0,r.jsx)(n.h3,{id:"5-optimization",children:"5. Optimization"}),"\n",(0,r.jsx)(n.p,{children:"Current optimizations:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Constant folding"}),": ",(0,r.jsx)(n.code,{children:"2 + 3"})," \u2192 ",(0,r.jsx)(n.code,{children:"5"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Dead code elimination"}),": Remove unreachable code"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Peephole optimization"}),": ",(0,r.jsx)(n.code,{children:"PUSH 0; ADD"})," \u2192 (removed)"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"6-code-generation",children:"6. Code Generation"}),"\n",(0,r.jsxs)(n.p,{children:["The IR is serialized to ZPLC bytecode in the ",(0,r.jsx)(n.code,{children:".zplc"})," binary format."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"language-support",children:"Language Support"}),"\n",(0,r.jsx)(n.h3,{id:"data-types",children:"Data Types"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Description"}),(0,r.jsx)(n.th,{children:"Example"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"BOOL"}),(0,r.jsx)(n.td,{children:"Boolean"}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"TRUE"}),", ",(0,r.jsx)(n.code,{children:"FALSE"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"INT"}),(0,r.jsx)(n.td,{children:"16-bit signed"}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"-32768"})," to ",(0,r.jsx)(n.code,{children:"32767"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"DINT"}),(0,r.jsx)(n.td,{children:"32-bit signed"}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"-2147483648"})," to ",(0,r.jsx)(n.code,{children:"2147483647"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"REAL"}),(0,r.jsx)(n.td,{children:"32-bit float"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"3.14159"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"TIME"}),(0,r.jsx)(n.td,{children:"Duration"}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"T#5s"}),", ",(0,r.jsx)(n.code,{children:"T#100ms"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"STRING"}),(0,r.jsx)(n.td,{children:"Text (limited)"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"'Hello'"})})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"operators",children:"Operators"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Category"}),(0,r.jsx)(n.th,{children:"Operators"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Arithmetic"}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"+"}),", ",(0,r.jsx)(n.code,{children:"-"}),", ",(0,r.jsx)(n.code,{children:"*"}),", ",(0,r.jsx)(n.code,{children:"/"}),", ",(0,r.jsx)(n.code,{children:"MOD"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Comparison"}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"="}),", ",(0,r.jsx)(n.code,{children:"<>"}),", ",(0,r.jsx)(n.code,{children:"<"}),", ",(0,r.jsx)(n.code,{children:"<="}),", ",(0,r.jsx)(n.code,{children:">"}),", ",(0,r.jsx)(n.code,{children:">="})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Logical"}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"AND"}),", ",(0,r.jsx)(n.code,{children:"OR"}),", ",(0,r.jsx)(n.code,{children:"XOR"}),", ",(0,r.jsx)(n.code,{children:"NOT"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Bitwise"}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"AND"}),", ",(0,r.jsx)(n.code,{children:"OR"}),", ",(0,r.jsx)(n.code,{children:"XOR"}),", ",(0,r.jsx)(n.code,{children:"NOT"}),", ",(0,r.jsx)(n.code,{children:"SHL"}),", ",(0,r.jsx)(n.code,{children:"SHR"})]})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"control-structures",children:"Control Structures"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-st",children:"// Conditional\nIF condition THEN\n    // statements\nELSIF other_condition THEN\n    // statements  \nELSE\n    // statements\nEND_IF;\n\n// Case selection\nCASE selector OF\n    1: action1();\n    2, 3: action2();\n    ELSE: default_action();\nEND_CASE;\n\n// Counted loop\nFOR i := 1 TO 10 BY 1 DO\n    // statements\nEND_FOR;\n\n// While loop\nWHILE condition DO\n    // statements\nEND_WHILE;\n\n// Repeat loop\nREPEAT\n    // statements\nUNTIL condition\nEND_REPEAT;\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"function-blocks",children:"Function Blocks"}),"\n",(0,r.jsx)(n.h3,{id:"using-standard-fbs",children:"Using Standard FBs"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-st",children:"VAR\n    start_delay : TON;  // Instance of TON timer\n    motor_running : BOOL;\nEND_VAR\n\n// Call the FB\nstart_delay(IN := start_button, PT := T#2s);\n\n// Access outputs\nmotor_running := start_delay.Q;\n"})}),"\n",(0,r.jsx)(n.h3,{id:"defining-custom-fbs",children:"Defining Custom FBs"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-st",children:"FUNCTION_BLOCK Hysteresis\nVAR_INPUT\n    input_val : REAL;\n    high_limit : REAL;\n    low_limit : REAL;\nEND_VAR\nVAR_OUTPUT\n    output : BOOL;\nEND_VAR\nVAR\n    state : BOOL;\nEND_VAR\n\nIF input_val >= high_limit THEN\n    state := TRUE;\nELSIF input_val <= low_limit THEN\n    state := FALSE;\nEND_IF;\n\noutput := state;\n\nEND_FUNCTION_BLOCK\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"compiler-messages",children:"Compiler Messages"}),"\n",(0,r.jsx)(n.h3,{id:"error-format",children:"Error Format"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"ERROR: [line:col] message\n"})}),"\n",(0,r.jsx)(n.h3,{id:"common-errors",children:"Common Errors"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Error"}),(0,r.jsx)(n.th,{children:"Cause"}),(0,r.jsx)(n.th,{children:"Fix"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"Undeclared identifier 'x'"})}),(0,r.jsx)(n.td,{children:"Variable not in VAR block"}),(0,r.jsx)(n.td,{children:"Add declaration"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"Type mismatch: BOOL vs INT"})}),(0,r.jsx)(n.td,{children:"Incompatible assignment"}),(0,r.jsx)(n.td,{children:"Use type conversion"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"Function 'foo' not found"})}),(0,r.jsx)(n.td,{children:"Missing FB or function"}),(0,r.jsx)(n.td,{children:"Check spelling/import"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"Expected ';'"})}),(0,r.jsx)(n.td,{children:"Missing statement terminator"}),(0,r.jsx)(n.td,{children:"Add semicolon"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"warnings",children:"Warnings"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Unused variables"}),"\n",(0,r.jsx)(n.li,{children:"Unreachable code"}),"\n",(0,r.jsx)(n.li,{children:"Implicit type conversions"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"compiler-options",children:"Compiler Options"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Option"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--optimize"})}),(0,r.jsx)(n.td,{children:"Enable all optimizations"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--debug"})}),(0,r.jsx)(n.td,{children:"Include debug symbols"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--strict"})}),(0,r.jsx)(n.td,{children:"Treat warnings as errors"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--target <version>"})}),(0,r.jsx)(n.td,{children:"Target VM version"})]})]})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"output-the-zplc-file",children:"Output: The .zplc File"}),"\n",(0,r.jsx)(n.p,{children:"The compiler produces a binary package containing:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Header"}),": Magic number, version, CRC32"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Code Segment"}),": Bytecode instructions"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Data Segment"}),": Constants and initial values"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Symbol Table"}),": Variable names and addresses (optional)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Debug Info"}),": Source line mapping (optional)"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"File size is typically 1-10 KB for most programs."})]})}function a(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}}}]);
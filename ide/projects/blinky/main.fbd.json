{
  "$schema": "./schemas/fbd.schema.json",
  "name": "Blinky",
  "description": "ZPLC Blinky - Function Block Diagram with timer feedback",
  "version": "2.1.0",

  "variables": {
    "local": [],
    "outputs": [
      {
        "name": "LED_Output",
        "type": "BOOL",
        "address": "%Q0.0",
        "comment": "Physical LED output - follows timer.Q directly"
      }
    ]
  },

  "blocks": [
    {
      "id": "var_led_read",
      "type": "variable",
      "variableName": "LED_Output",
      "direction": "read",
      "position": { "x": 50, "y": 50 },
      "outputs": [
        { "name": "OUT", "type": "BOOL" }
      ],
      "comment": "Read current LED output state"
    },
    {
      "id": "not_enable",
      "type": "NOT",
      "position": { "x": 150, "y": 50 },
      "inputs": [
        { "name": "IN", "type": "BOOL" }
      ],
      "outputs": [
        { "name": "OUT", "type": "BOOL" }
      ],
      "comment": "Invert: timer runs when LED is OFF"
    },
    {
      "id": "const_500ms",
      "type": "constant",
      "dataType": "TIME",
      "value": "T#500ms",
      "position": { "x": 150, "y": 120 },
      "outputs": [
        { "name": "OUT", "type": "TIME" }
      ]
    },
    {
      "id": "ton_timer",
      "type": "TON",
      "instanceName": "BlinkTimer",
      "position": { "x": 280, "y": 50 },
      "inputs": [
        { "name": "IN", "type": "BOOL" },
        { "name": "PT", "type": "TIME" }
      ],
      "outputs": [
        { "name": "Q", "type": "BOOL" },
        { "name": "ET", "type": "TIME" }
      ],
      "comment": "500ms on-delay timer"
    },
    {
      "id": "output_led",
      "type": "output",
      "variableName": "LED_Output",
      "position": { "x": 420, "y": 50 },
      "inputs": [
        { "name": "IN", "type": "BOOL" }
      ],
      "comment": "Physical LED output"
    }
  ],

  "connections": [
    {
      "id": "conn_led_to_not",
      "from": { "block": "var_led_read", "port": "OUT" },
      "to": { "block": "not_enable", "port": "IN" }
    },
    {
      "id": "conn_not_to_timer",
      "from": { "block": "not_enable", "port": "OUT" },
      "to": { "block": "ton_timer", "port": "IN" }
    },
    {
      "id": "conn_pt_to_timer",
      "from": { "block": "const_500ms", "port": "OUT" },
      "to": { "block": "ton_timer", "port": "PT" }
    },
    {
      "id": "conn_timer_to_led",
      "from": { "block": "ton_timer", "port": "Q" },
      "to": { "block": "output_led", "port": "IN" }
    }
  ],

  "metadata": {
    "author": "ZPLC Team",
    "created": "2024-12-27",
    "iecStandard": "IEC 61131-3",
    "notes": [
      "Classic oscillator pattern in FBD:",
      "1. Read LED_Output state",
      "2. NOT block inverts it (timer enabled when LED is OFF)",
      "3. TON timer counts when enabled",
      "4. When timer.Q = TRUE, LED turns ON",
      "5. LED ON → NOT output FALSE → timer resets → LED OFF",
      "6. Cycle repeats",
      "",
      "Note: This reads LED_Output as input, which the transpiler",
      "handles by using the variable value from the previous cycle."
    ]
  }
}

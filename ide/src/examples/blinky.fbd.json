{
  "$schema": "./schemas/fbd.schema.json",
  "name": "Blinky",
  "description": "ZPLC Golden Standard - Blinky in Function Block Diagram (FBD)",
  "version": "1.0.0",

  "variables": {
    "local": [
      {
        "name": "LedState",
        "type": "BOOL",
        "initialValue": false,
        "comment": "Current LED state (toggle memory)"
      }
    ],
    "outputs": [
      {
        "name": "LED_Output",
        "type": "BOOL",
        "address": "%Q0.0",
        "comment": "Physical LED output"
      }
    ]
  },

  "blocks": [
    {
      "id": "const_true",
      "type": "constant",
      "dataType": "BOOL",
      "value": true,
      "position": { "x": 50, "y": 50 },
      "outputs": [
        { "name": "OUT", "type": "BOOL" }
      ]
    },
    {
      "id": "const_500ms",
      "type": "constant",
      "dataType": "TIME",
      "value": "T#500ms",
      "position": { "x": 50, "y": 120 },
      "outputs": [
        { "name": "OUT", "type": "TIME" }
      ]
    },
    {
      "id": "ton_timer",
      "type": "TON",
      "instanceName": "BlinkTimer",
      "position": { "x": 200, "y": 50 },
      "inputs": [
        { "name": "IN", "type": "BOOL" },
        { "name": "PT", "type": "TIME" }
      ],
      "outputs": [
        { "name": "Q", "type": "BOOL" },
        { "name": "ET", "type": "TIME" }
      ],
      "comment": "500ms timer for blink rate"
    },
    {
      "id": "r_trig",
      "type": "R_TRIG",
      "instanceName": "EdgeDetect",
      "position": { "x": 380, "y": 50 },
      "inputs": [
        { "name": "CLK", "type": "BOOL" }
      ],
      "outputs": [
        { "name": "Q", "type": "BOOL" }
      ],
      "comment": "Rising edge detection on timer output"
    },
    {
      "id": "sr_latch",
      "type": "SR",
      "instanceName": "LedLatch",
      "position": { "x": 550, "y": 50 },
      "inputs": [
        { "name": "S1", "type": "BOOL" },
        { "name": "R", "type": "BOOL" }
      ],
      "outputs": [
        { "name": "Q1", "type": "BOOL" }
      ],
      "comment": "Toggle logic using SR latch"
    },
    {
      "id": "not_gate",
      "type": "NOT",
      "position": { "x": 380, "y": 150 },
      "inputs": [
        { "name": "IN", "type": "BOOL" }
      ],
      "outputs": [
        { "name": "OUT", "type": "BOOL" }
      ],
      "comment": "Invert current state for toggle"
    },
    {
      "id": "and_set",
      "type": "AND",
      "position": { "x": 480, "y": 50 },
      "inputs": [
        { "name": "IN1", "type": "BOOL" },
        { "name": "IN2", "type": "BOOL" }
      ],
      "outputs": [
        { "name": "OUT", "type": "BOOL" }
      ],
      "comment": "Set condition: edge AND NOT current state"
    },
    {
      "id": "and_reset",
      "type": "AND",
      "position": { "x": 480, "y": 120 },
      "inputs": [
        { "name": "IN1", "type": "BOOL" },
        { "name": "IN2", "type": "BOOL" }
      ],
      "outputs": [
        { "name": "OUT", "type": "BOOL" }
      ],
      "comment": "Reset condition: edge AND current state"
    },
    {
      "id": "var_ledstate",
      "type": "variable",
      "variableName": "LedState",
      "position": { "x": 300, "y": 200 },
      "inputs": [
        { "name": "IN", "type": "BOOL" }
      ],
      "outputs": [
        { "name": "OUT", "type": "BOOL" }
      ],
      "comment": "Feedback: current LED state"
    },
    {
      "id": "output_led",
      "type": "output",
      "variableName": "LED_Output",
      "position": { "x": 700, "y": 50 },
      "inputs": [
        { "name": "IN", "type": "BOOL" }
      ],
      "comment": "Physical output to LED"
    }
  ],

  "connections": [
    {
      "id": "conn_1",
      "from": { "block": "const_true", "port": "OUT" },
      "to": { "block": "ton_timer", "port": "IN" }
    },
    {
      "id": "conn_2",
      "from": { "block": "const_500ms", "port": "OUT" },
      "to": { "block": "ton_timer", "port": "PT" }
    },
    {
      "id": "conn_3",
      "from": { "block": "ton_timer", "port": "Q" },
      "to": { "block": "r_trig", "port": "CLK" }
    },
    {
      "id": "conn_4",
      "from": { "block": "r_trig", "port": "Q" },
      "to": { "block": "and_set", "port": "IN1" }
    },
    {
      "id": "conn_5",
      "from": { "block": "r_trig", "port": "Q" },
      "to": { "block": "and_reset", "port": "IN1" }
    },
    {
      "id": "conn_6",
      "from": { "block": "var_ledstate", "port": "OUT" },
      "to": { "block": "not_gate", "port": "IN" }
    },
    {
      "id": "conn_7",
      "from": { "block": "not_gate", "port": "OUT" },
      "to": { "block": "and_set", "port": "IN2" }
    },
    {
      "id": "conn_8",
      "from": { "block": "var_ledstate", "port": "OUT" },
      "to": { "block": "and_reset", "port": "IN2" }
    },
    {
      "id": "conn_9",
      "from": { "block": "and_set", "port": "OUT" },
      "to": { "block": "sr_latch", "port": "S1" }
    },
    {
      "id": "conn_10",
      "from": { "block": "and_reset", "port": "OUT" },
      "to": { "block": "sr_latch", "port": "R" }
    },
    {
      "id": "conn_11",
      "from": { "block": "sr_latch", "port": "Q1" },
      "to": { "block": "var_ledstate", "port": "IN" }
    },
    {
      "id": "conn_12",
      "from": { "block": "sr_latch", "port": "Q1" },
      "to": { "block": "output_led", "port": "IN" }
    }
  ],

  "metadata": {
    "author": "ZPLC Team",
    "created": "2024-12-23",
    "iecStandard": "IEC 61131-3",
    "blockCategories": {
      "logic": ["AND", "OR", "NOT", "XOR", "NAND", "NOR"],
      "timers": ["TON", "TOF", "TP"],
      "counters": ["CTU", "CTD", "CTUD"],
      "triggers": ["R_TRIG", "F_TRIG"],
      "bistables": ["SR", "RS"],
      "comparison": ["EQ", "NE", "LT", "LE", "GT", "GE"],
      "math": ["ADD", "SUB", "MUL", "DIV", "MOD", "ABS"]
    }
  }
}

{
  "$schema": "./schemas/fbd.schema.json",
  "name": "Blinky",
  "description": "ZPLC Blinky - Function Block Diagram with oscillating timer",
  "version": "2.0.0",

  "variables": {
    "local": [],
    "outputs": [
      {
        "name": "LED_Output",
        "type": "BOOL",
        "address": "%Q0.0",
        "comment": "Physical LED output"
      }
    ]
  },

  "blocks": [
    {
      "id": "not_feedback",
      "type": "NOT",
      "position": { "x": 50, "y": 80 },
      "inputs": [
        { "name": "IN", "type": "BOOL" }
      ],
      "outputs": [
        { "name": "OUT", "type": "BOOL" }
      ],
      "comment": "Invert LED_Output for timer enable"
    },
    {
      "id": "const_500ms",
      "type": "constant",
      "dataType": "TIME",
      "value": "T#500ms",
      "position": { "x": 50, "y": 150 },
      "outputs": [
        { "name": "OUT", "type": "TIME" }
      ]
    },
    {
      "id": "ton_timer",
      "type": "TON",
      "instanceName": "BlinkTimer",
      "position": { "x": 200, "y": 80 },
      "inputs": [
        { "name": "IN", "type": "BOOL" },
        { "name": "PT", "type": "TIME" }
      ],
      "outputs": [
        { "name": "Q", "type": "BOOL" },
        { "name": "ET", "type": "TIME" }
      ],
      "comment": "500ms on-delay timer"
    },
    {
      "id": "output_led",
      "type": "output",
      "variableName": "LED_Output",
      "position": { "x": 400, "y": 80 },
      "inputs": [
        { "name": "IN", "type": "BOOL" }
      ],
      "comment": "Physical LED output"
    }
  ],

  "connections": [
    {
      "id": "conn_feedback",
      "from": { "block": "output_led", "port": "IN" },
      "to": { "block": "not_feedback", "port": "IN" },
      "comment": "Feedback loop: LED state inverted to timer input"
    },
    {
      "id": "conn_timer_in",
      "from": { "block": "not_feedback", "port": "OUT" },
      "to": { "block": "ton_timer", "port": "IN" }
    },
    {
      "id": "conn_timer_pt",
      "from": { "block": "const_500ms", "port": "OUT" },
      "to": { "block": "ton_timer", "port": "PT" }
    },
    {
      "id": "conn_timer_out",
      "from": { "block": "ton_timer", "port": "Q" },
      "to": { "block": "output_led", "port": "IN" }
    }
  ],

  "metadata": {
    "author": "ZPLC Team",
    "created": "2024-12-27",
    "iecStandard": "IEC 61131-3",
    "notes": [
      "Classic oscillator pattern in FBD:",
      "1. NOT block inverts LED_Output to create enable signal",
      "2. TON timer runs when enable is TRUE (LED is OFF)",
      "3. When timer.Q becomes TRUE, LED_Output turns ON",
      "4. LED ON -> NOT output FALSE -> timer resets -> LED OFF",
      "5. LED OFF -> NOT output TRUE -> timer starts again",
      "",
      "The feedback connection from output_led back to not_feedback",
      "creates the oscillation loop."
    ]
  }
}

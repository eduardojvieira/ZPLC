/*
 * ZPLC Board Overlay - Raspberry Pi Pico (RP2040)
 * SPDX-License-Identifier: MIT
 *
 * The RPi Pico already defines:
 *   - led0 (GPIO25, onboard LED)
 *
 * This overlay:
 *   - Enables USB CDC ACM as the console/shell interface
 *   - Adds a button input for testing
 *   - Defines a storage partition for NVS (program persistence)
 *
 * Hardware connection:
 *   GPIO15 -> Button -> GND (optional)
 *
 * Flash Layout (2MB total):
 *   0x000000 - 0x1EFFFF: Application code (1984 KB)
 *   0x1F0000 - 0x1FFFFF: NVS Storage (64 KB)
 */

/ {
    chosen {
        /* Use USB CDC ACM for console and shell */
        zephyr,console = &cdc_acm_uart0;
        zephyr,shell-uart = &cdc_acm_uart0;
    };

    zephyr,user {
        /* ADC channel 4 is the internal temperature sensor on RP2040 */
        io-channels = <&adc 4>;
        io-channel-names = "temp";
    };

    gpio_keys {
        compatible = "gpio-keys";
        
        /* User button on GPIO15 with internal pull-up */
        button0: button_0 {
            gpios = <&gpio0 15 (GPIO_PULL_UP | GPIO_ACTIVE_LOW)>;
            label = "ZPLC Input 0";
            zephyr,code = <0>;
        };
    };
    
    leds {
        compatible = "gpio-leds";
        led0: led_0 {
            gpios = <&gpio0 0 GPIO_ACTIVE_HIGH>;
            label = "ZPLC Output 0 (GP0)";
        };
        led1: led_1 {
            gpios = <&gpio0 1 GPIO_ACTIVE_HIGH>;
            label = "ZPLC Output 1 (GP1)";
        };
        led2: led_2 {
            gpios = <&gpio0 2 GPIO_ACTIVE_HIGH>;
            label = "ZPLC Output 2 (GP2)";
        };
        led3: led_3 {
            gpios = <&gpio0 3 GPIO_ACTIVE_HIGH>;
            label = "ZPLC Output 3 (GP3)";
        };
    };

    aliases {
        sw0 = &button0;
        led0 = &led0;
        led1 = &led1;
        led2 = &led2;
        led3 = &led3;
    };
};

/* Enable ADC for analog input */
&adc {
    status = "okay";
    #address-cells = <1>;
    #size-cells = <0>;
};

/* Define flash partitions for NVS storage */
&flash0 {
    partitions {
        compatible = "fixed-partitions";
        #address-cells = <1>;
        #size-cells = <1>;

        /*
         * Storage partition for NVS (Non-Volatile Storage)
         * Located at the end of flash: 64KB for program persistence
         * This allows storing ZPLC programs up to ~60KB
         */
        storage_partition: partition@1f0000 {
            label = "storage";
            reg = <0x1f0000 0x10000>;
        };
    };
};

/* Enable USB and configure CDC ACM device */
&zephyr_udc0 {
    cdc_acm_uart0: cdc_acm_uart0 {
        compatible = "zephyr,cdc-acm-uart";
    };
};

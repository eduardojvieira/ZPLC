# =============================================================================
# ZPLC Zephyr Application Configuration
# =============================================================================
# SPDX-License-Identifier: MIT
# =============================================================================

# Enable the ZPLC module
CONFIG_ZPLC=y

# -----------------------------------------------------------------------------
# GPIO Configuration (Required for Phase 3 Hardware I/O)
# -----------------------------------------------------------------------------
CONFIG_GPIO=y

# -----------------------------------------------------------------------------
# ADC Configuration (Analog Input Support)
# -----------------------------------------------------------------------------
CONFIG_ADC=y

# -----------------------------------------------------------------------------
# Logging Configuration
# -----------------------------------------------------------------------------
CONFIG_PRINTK=y
CONFIG_LOG=y
CONFIG_ZPLC_LOG_LEVEL=3

# -----------------------------------------------------------------------------
# Stack/Memory Configuration
# -----------------------------------------------------------------------------
CONFIG_MAIN_STACK_SIZE=4096

# Increase heap for boards with limited defaults
CONFIG_HEAP_MEM_POOL_SIZE=2048

# -----------------------------------------------------------------------------
# Flash & Persistence Configuration (NVS)
# -----------------------------------------------------------------------------
# Required for storing programs in Flash (non-volatile storage)
# We use NVS directly for simpler and more reliable persistence
CONFIG_FLASH=y
CONFIG_FLASH_PAGE_LAYOUT=y
CONFIG_FLASH_MAP=y
CONFIG_NVS=y

# -----------------------------------------------------------------------------
# Shell for Runtime Management (Required for Phase 3 Serial Upload)
# -----------------------------------------------------------------------------
CONFIG_SHELL=y
CONFIG_SHELL_BACKEND_SERIAL=y

# Shell configuration
CONFIG_SHELL_PROMPT_UART="zplc:~$ "

# CRITICAL: Buffer sizes for bytecode upload
# zplc data command can be: "zplc data " (10) + 64 hex chars + newline = 75 chars minimum
# Increase significantly to handle burst uploads without dropping chars
CONFIG_SHELL_CMD_BUFF_SIZE=4096
CONFIG_SHELL_PRINTF_BUFF_SIZE=2048

# Enable shell RX ring buffer with generous size
CONFIG_SHELL_BACKEND_SERIAL_RX_RING_BUFFER_SIZE=4096

# Use interrupt-driven mode for better responsiveness
CONFIG_SHELL_BACKEND_SERIAL_INTERRUPT_DRIVEN=y

# Increase stack for shell thread (needed for hex parsing)
CONFIG_SHELL_STACK_SIZE=4096

# -----------------------------------------------------------------------------
# USB CDC ACM Configuration (for boards with native USB like Pico)
# -----------------------------------------------------------------------------
# Enabled conditionally in board-specific configs (rpi_pico.conf)

# -----------------------------------------------------------------------------
# Multitask Scheduler Configuration
# -----------------------------------------------------------------------------
CONFIG_ZPLC_SCHEDULER=y
CONFIG_ZPLC_MAX_TASKS=4
CONFIG_ZPLC_SCHED_WORKQ_STACK_SIZE=2048
CONFIG_ZPLC_SCHED_WORKQ_PRIORITY=5
CONFIG_ZPLC_SCHED_HIGH_PRIO_WORKQ=y
CONFIG_ZPLC_SCHED_HIGH_PRIO_STACK_SIZE=2048
CONFIG_ZPLC_SCHED_HIGH_PRIO_PRIORITY=2

# -----------------------------------------------------------------------------
# System Reboot Support
# -----------------------------------------------------------------------------
CONFIG_REBOOT=y

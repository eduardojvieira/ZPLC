"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[4396],{7354(e,r,s){s.r(r),s.d(r,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"runtime/persistence","title":"Persistence & Retain Memory","description":"ZPLC provides mechanisms to ensure your data and program survive power cycles and resets. This is critical for industrial applications where setpoints, counters, and calibration data must be preserved.","source":"@site/docs/runtime/persistence.md","sourceDirName":"runtime","slug":"/runtime/persistence","permalink":"/ZPLC/docs/runtime/persistence","draft":false,"unlisted":false,"editUrl":"https://github.com/eduardojvieira/ZPLC/tree/master/docs/docs/runtime/persistence.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"Multitask Scheduler","permalink":"/ZPLC/docs/runtime/scheduler"},"next":{"title":"Hardware Abstraction Layer (HAL)","permalink":"/ZPLC/docs/runtime/hal"}}');var t=s(4848),n=s(8453);const a={sidebar_position:3},l="Persistence & Retain Memory",o={},d=[{value:"Program Persistence",id:"program-persistence",level:2},{value:"Shell Commands",id:"shell-commands",level:3},{value:"Retentive Memory (RETAIN)",id:"retentive-memory-retain",level:2},{value:"Declaration (ST)",id:"declaration-st",level:3},{value:"How It Works",id:"how-it-works",level:3},{value:"Best Practices",id:"best-practices",level:3},{value:"Hardware Support",id:"hardware-support",level:2}];function c(e){const r={admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,n.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.header,{children:(0,t.jsx)(r.h1,{id:"persistence--retain-memory",children:"Persistence & Retain Memory"})}),"\n",(0,t.jsx)(r.p,{children:"ZPLC provides mechanisms to ensure your data and program survive power cycles and resets. This is critical for industrial applications where setpoints, counters, and calibration data must be preserved."}),"\n",(0,t.jsx)(r.h2,{id:"program-persistence",children:"Program Persistence"}),"\n",(0,t.jsx)(r.p,{children:"When you upload a program to a ZPLC controller, it is automatically saved to the device's non-volatile storage (Flash memory)."}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Mechanism"}),": Uses Zephyr's ",(0,t.jsx)(r.strong,{children:"NVS (Non-Volatile Storage)"})," subsystem."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Behavior"}),": On boot, the runtime checks NVS. If a valid program is found (verified by CRC), it is loaded into RAM and executed."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Storage Partition"}),": Requires a dedicated partition in the device's Flash map (usually labeled ",(0,t.jsx)(r.code,{children:"storage_partition"}),")."]}),"\n"]}),"\n",(0,t.jsx)(r.h3,{id:"shell-commands",children:"Shell Commands"}),"\n",(0,t.jsx)(r.p,{children:"You can manage stored programs via the serial shell:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"zplc persist info    # Show size and version of saved program\nzplc persist clear   # Erase the saved program (device will boot empty)\n"})}),"\n",(0,t.jsx)(r.h2,{id:"retentive-memory-retain",children:"Retentive Memory (RETAIN)"}),"\n",(0,t.jsxs)(r.p,{children:["Retentive memory is a special data region used for variables declared with the ",(0,t.jsx)(r.code,{children:"RETAIN"})," keyword. These variables are saved to non-volatile storage during power-down or at specific intervals."]}),"\n",(0,t.jsx)(r.h3,{id:"declaration-st",children:"Declaration (ST)"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-st",children:"VAR RETAIN\n    setpoint : REAL := 25.5;\n    run_hours : UDINT;\nEND_VAR\n"})}),"\n",(0,t.jsx)(r.h3,{id:"how-it-works",children:"How It Works"}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Memory Region"}),": The VM allocates a dedicated 4KB block (default) at ",(0,t.jsx)(r.code,{children:"0x4000"})," for RETAIN variables."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Auto-Save"}),": The runtime monitors the power supply (if hardware supports PFI - Power Fail Interrupt) or saves periodically."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Restore"}),": On boot, this memory block is re-populated from NVS before the program starts."]}),"\n"]}),"\n",(0,t.jsx)(r.h3,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Minimize Writes"}),": Flash memory has limited write cycles (typically 10k-100k). Avoid writing to RETAIN variables in every cycle. Only update them when values actually change."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Critical Data Only"}),": Use RETAIN only for data that ",(0,t.jsx)(r.em,{children:"must"})," survive a reboot (e.g., totalizers, configuration parameters). Use standard ",(0,t.jsx)(r.code,{children:"VAR"})," for everything else."]}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"hardware-support",children:"Hardware Support"}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.th,{children:"Platform"}),(0,t.jsx)(r.th,{children:"Storage Backend"}),(0,t.jsx)(r.th,{children:"Status"})]})}),(0,t.jsxs)(r.tbody,{children:[(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.strong,{children:"Zephyr (Embedded)"})}),(0,t.jsx)(r.td,{children:"NVS (Flash)"}),(0,t.jsx)(r.td,{children:"\u2705 Supported"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.strong,{children:"POSIX (Sim/Desktop)"})}),(0,t.jsxs)(r.td,{children:["File System (",(0,t.jsx)(r.code,{children:"zplc_nv.bin"}),")"]}),(0,t.jsx)(r.td,{children:"\u2705 Supported"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.strong,{children:"WASM (Web)"})}),(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"localStorage"})}),(0,t.jsx)(r.td,{children:"\u2705 Supported"})]})]})]}),"\n",(0,t.jsx)(r.admonition,{title:"Raspberry Pi Pico Note",type:"info",children:(0,t.jsx)(r.p,{children:"On the RP2040 (Pico), the last 64KB of flash is reserved for the file system. Ensure your board definition includes the correct partition layout."})})]})}function h(e={}){const{wrapper:r}={...(0,n.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}}}]);
"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[69],{5583(e,s,r){r.r(s),r.d(s,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"runtime/scheduler","title":"Multitask Scheduler","description":"ZPLC supports deterministic multitasking, allowing you to run different parts of your program at different intervals and priority levels. This is essential for complex industrial applications where fast control loops (e.g., motion control) must run alongside slower monitoring tasks (e.g., temperature logging).","source":"@site/docs/runtime/scheduler.md","sourceDirName":"runtime","slug":"/runtime/scheduler","permalink":"/ZPLC/docs/runtime/scheduler","draft":false,"unlisted":false,"editUrl":"https://github.com/eduardojvieira/ZPLC/tree/master/docs/docs/runtime/scheduler.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"docsSidebar","previous":{"title":"ZPLC Virtual Machine - Instruction Set Architecture (ISA)","permalink":"/ZPLC/docs/runtime/isa"},"next":{"title":"Persistence & Retain Memory","permalink":"/ZPLC/docs/runtime/persistence"}}');var t=r(4848),n=r(8453);const l={sidebar_position:2},o="Multitask Scheduler",a={},d=[{value:"Overview",id:"overview",level:2},{value:"Task Configuration",id:"task-configuration",level:2},{value:"Properties",id:"properties",level:3},{value:"Execution Model",id:"execution-model",level:2},{value:"Example Scenario",id:"example-scenario",level:3},{value:"Watchdog",id:"watchdog",level:2},{value:"Memory Isolation",id:"memory-isolation",level:2}];function c(e){const s={admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,n.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"multitask-scheduler",children:"Multitask Scheduler"})}),"\n",(0,t.jsx)(s.p,{children:"ZPLC supports deterministic multitasking, allowing you to run different parts of your program at different intervals and priority levels. This is essential for complex industrial applications where fast control loops (e.g., motion control) must run alongside slower monitoring tasks (e.g., temperature logging)."}),"\n",(0,t.jsx)(s.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsxs)(s.p,{children:["The scheduler uses a ",(0,t.jsx)(s.strong,{children:"priority-based preemptive"})," model."]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Priority"}),": Lower number = Higher priority. Task 0 (High) can interrupt Task 1 (Low)."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Interval"}),": Each task has a defined cycle time (e.g., 10ms, 100ms)."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Isolation"}),': Each task has its own isolated "Work Memory" (Stack + Heap) to prevent data corruption.']}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Shared Memory"}),": All tasks share the Process Images (IPI/OPI) and Global/Retain variables for inter-task communication."]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"task-configuration",children:"Task Configuration"}),"\n",(0,t.jsxs)(s.p,{children:["Tasks are defined in the project configuration (",(0,t.jsx)(s.code,{children:"zplc.json"}),") and compiled into the ",(0,t.jsx)(s.code,{children:".zplc"})," binary header."]}),"\n",(0,t.jsx)(s.h3,{id:"properties",children:"Properties"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Property"}),(0,t.jsx)(s.th,{children:"Description"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.strong,{children:"ID"})}),(0,t.jsx)(s.td,{children:"Unique identifier (0-255)."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.strong,{children:"Type"})}),(0,t.jsxs)(s.td,{children:[(0,t.jsx)(s.code,{children:"CYCLIC"})," (periodic execution) or ",(0,t.jsx)(s.code,{children:"EVENT"})," (triggered by interrupt - ",(0,t.jsx)(s.em,{children:"future"}),")."]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.strong,{children:"Interval"})}),(0,t.jsx)(s.td,{children:"Cycle time in milliseconds (ms)."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.strong,{children:"Priority"})}),(0,t.jsx)(s.td,{children:"0 (Highest) to 255 (Lowest)."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.strong,{children:"Entry Point"})}),(0,t.jsx)(s.td,{children:"Bytecode address where the task begins."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.strong,{children:"Stack Size"})}),(0,t.jsx)(s.td,{children:"Memory allocated for the evaluation stack (default: 1024 bytes)."})]})]})]}),"\n",(0,t.jsx)(s.h2,{id:"execution-model",children:"Execution Model"}),"\n",(0,t.jsx)(s.p,{children:"The scheduler runs on top of the underlying RTOS (Zephyr or POSIX)."}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Tick"}),": The system timer triggers the scheduler every 1ms (or configured tick rate)."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Ready Queue"}),": The scheduler checks which tasks are due based on their interval."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Preemption"}),": If a higher-priority task becomes ready while a lower-priority task is running, the current task is paused, and the high-priority task runs immediately."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Completion"}),": When a task finishes (",(0,t.jsx)(s.code,{children:"RET"})," opcode), control returns to the scheduler or the interrupted task."]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"example-scenario",children:"Example Scenario"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Task A (Fast)"}),": 10ms interval, Priority 0. Handles encoder reading."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Task B (Slow)"}),": 100ms interval, Priority 1. Handles UI updates."]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Timeline:"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"0ms:   Task A starts -> Task A ends\n       Task B starts\n10ms:  Task A interrupts Task B -> Task A runs -> Task A ends -> Task B resumes\n20ms:  Task A interrupts Task B -> ...\n...\n100ms: Task B finally finishes (if CPU load allows)\n"})}),"\n",(0,t.jsx)(s.h2,{id:"watchdog",children:"Watchdog"}),"\n",(0,t.jsxs)(s.p,{children:["To prevent system lockups, each task has a ",(0,t.jsx)(s.strong,{children:"Watchdog Timer"}),". If a task takes longer than its configured ",(0,t.jsx)(s.code,{children:"Interval"})," (or a global limit) to complete, the runtime will trigger a system fault and enter a safe state."]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Common Causes"}),": Infinite loops (",(0,t.jsx)(s.code,{children:"WHILE TRUE DO"}),"), extremely heavy computations."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Recovery"}),": Requires a system reset or manual intervention via shell."]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"memory-isolation",children:"Memory Isolation"}),"\n",(0,t.jsxs)(s.p,{children:["While tasks share global variables, their ",(0,t.jsx)(s.strong,{children:"local"})," execution state is completely isolated:"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Evaluation Stack"}),": Private to the task."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Call Stack"}),": Private to the task."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Work Memory"}),": Private temporary storage."]}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["This means you can call the same Function Block from different tasks without stack corruption, ",(0,t.jsx)(s.em,{children:"provided"})," the Function Block instance itself (its state) is unique or thread-safe."]}),"\n",(0,t.jsx)(s.admonition,{title:"Concurrency",type:"warning",children:(0,t.jsx)(s.p,{children:'If two tasks write to the same Global Variable or Output, the "Last Write Wins". For critical data exchange, use atomic operations or specific synchronization primitives (Roadmap v1.5).'})})]})}function h(e={}){const{wrapper:s}={...(0,n.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}}}]);